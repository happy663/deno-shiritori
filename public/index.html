<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
  </head>

  <body class="text-center">
    <div id="main ">
      <h1>しりとり</h1>
      <p id="previousWord"></p>
      <input type="text" id="nextWordInput" class="rounded py-1" />
      <button id="nextWordSendButton" class="btn bg-primary text-white mb-1">
        送信
      </button>
      <div class="">
        <div>
          <button id="reset" class="btn my-2">履歴リセット</button>
        </div>
      </div>
      <div class="w-25 mx-auto bg-light">
        <p>履歴</p>
        <div id="history"></div>
      </div>
    </div>

    <script type="module">
      window.onload = async (event) => {
        const response = await fetch("/shiritori");
        const previousWord = await response.text();
        const para = document.querySelector("#previousWord");
        para.innerText = `前の単語：${previousWord}`;

        const history = document.querySelector("#history");
        const usedWords = await fetch("/history").then((res) => res.json());
        console.log(usedWords);
        usedWords.forEach((word) => {
          const div = document.createElement("div");
          const newText = document.createTextNode(word);
          div.appendChild(newText);
          history.appendChild(div);
        });
      };
      document.querySelector("#nextWordSendButton").onclick = async (event) => {
        const nextWord = document.querySelector("#nextWordInput").value;
        const response = await fetch("/shiritori", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nextWord }),
        });

        if (response.status / 100 !== 2) {
          alert(await response.text());
          return;
        }
        const previousWord = await response.text();
        const para = document.querySelector("#previousWord");
        para.innerText = `前の単語：${previousWord}`;
        nextWordInput.value = "";

        const history = document.querySelector("#history");
        const div = document.createElement("div");
        const newText = document.createTextNode(previousWord);
        div.appendChild(newText);
        history.appendChild(div);
      };

      document.querySelector("#reset").onclick = async (event) => {
        await fetch("/reset", {
          method: "POST",
        });
        location.reload();
      };
    </script>
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
